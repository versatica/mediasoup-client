/*
 * mediasoup-client v2.0.18
 * mediasoup client side JavaScript SDK
 * https://mediasoup.org
 * Copyright © 2017, Iñaki Baz Castillo <ibc@aliax.net>
 * License: ISC
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mediasoupClient=e()}}(function(){return function a(i,s,c){function u(t,e){if(!s[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};i[t][0].call(o.exports,function(e){return u(i[t][1][e]||e)},o,o.exports,a,i,s,c)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=e("events"),i=e("./Logger"),s=(n=i)&&n.__esModule?n:{default:n},c=e("./errors");var u=new s.default("CommandQueue"),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EventEmitter),o(t,[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var n=this,o=Object.assign({method:e},t);return u.debug("push() [method:%s]",e),new Promise(function(e,t){var r=n._queue;o.resolve=e,o.reject=t,r.push(o),n._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(t){var r=this;if(u.debug("_handleCommand() [method:%s]",t.method),this._closed)return t.reject(new c.InvalidStateError("closed")),Promise.resolve();var e={promise:null};return this.emit("exec",t,e),Promise.resolve().then(function(){return e.promise}).then(function(e){u.debug("_handleCommand() | command succeeded [method:%s]",t.method),r._closed?t.reject(new c.InvalidStateError("closed")):t.resolve(e)}).catch(function(e){u.error("_handleCommand() | command failed [method:%s]: %o",t.method,e),t.reject(e)})}}]),t}();r.default=d},{"./Logger":5,"./errors":10,events:30}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=i(e("./Logger")),s=i(e("./EnhancedEventEmitter")),c=e("./errors");function i(e){return e&&e.__esModule?e:{default:e}}var u=new Set(["default","low","medium","high"]),d=new a.default("Consumer"),l=function(e){function i(e,t,r,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,d));return a._id=e,a._closed=!1,a._kind=t,a._rtpParameters=r,a._peer=n,a._appData=o,a._supported=!1,a._transport=null,a._track=null,a._locallyPaused=!1,a._remotelyPaused=!1,a._statsEnabled=!1,a._statsInterval=1e3,a._preferredProfile="default",a._effectiveProfile=null,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,s.default),o(i,[{key:"close",value:function(){d.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){d.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(t){var r=this;return d.debug("receive() [transport:%o]",t),this._closed?Promise.reject(new c.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===t?"undefined":n(t))?Promise.reject(new TypeError("invalid Transport")):(this._transport=t).addConsumer(this).then(function(e){return r._track=e,r.paused&&(e.enabled=!1),t.once("@close",function(){if(!r._closed&&r._transport===t){r._transport=null;try{r._track.stop()}catch(e){}r._track=null,r.safeEmit("unhandled")}}),r.safeEmit("handled"),r._statsEnabled&&t.enableConsumerStats(r,r._statsInterval),e}).catch(function(e){throw r._transport=null,e}):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return d.debug("pause()"),this._closed?(d.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){d.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return d.debug("resume()"),this._closed?(d.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){d.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){d.debug("setPreferredProfile() [profile:%s]",e),this._closed?d.error("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(u.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):d.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){d.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){d.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;d.debug("enableStats() [interval:%s]",e),this._closed?d.error("enableStats() | Consumer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){d.debug("disableStats()"),this._closed?d.error("disableStats() | Consumer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}]),i}();r.default=l},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10}],3:[function(m,e,h){(function(n){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var e=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=r(m("bowser")),t=r(m("./Logger")),a=r(m("./handlers/Chrome55")),i=r(m("./handlers/Chrome67")),s=r(m("./handlers/Safari11")),c=r(m("./handlers/Firefox50")),u=r(m("./handlers/Firefox59")),d=r(m("./handlers/Edge11")),l=r(m("./handlers/ReactNative"));function r(e){return e&&e.__esModule?e:{default:e}}var p=new t.default("Device"),f=function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}return e(r,null,[{key:"getFlag",value:function(){return r._detected||r._detect(),r._flag}},{key:"getName",value:function(){return r._detected||r._detect(),r._name}},{key:"getVersion",value:function(){return r._detected||r._detect(),r._version}},{key:"getBowser",value:function(){return r._detected||r._detect(),r._bowser}},{key:"isSupported",value:function(){return r._detected||r._detect(),Boolean(r._handlerClass)}},{key:"_detect",value:function(){if(r._detected=!0,n.navigator&&"ReactNative"===n.navigator.product)r._flag="react-native",r._name="ReactNative",r._version=void 0,r._bowser={},r._handlerClass=l.default;else if(n.navigator&&"string"==typeof n.navigator.userAgent){var e=n.navigator.userAgent,t=o.default.detect(e);r._flag=void 0,r._name=t.name||void 0,r._version=t.version||void 0,r._bowser=t,r._handlerClass=null,o.default.check({chrome:"67",chromium:"67"},!0,e)?(r._flag="chrome",r._handlerClass=i.default):o.default.check({chrome:"55",chromium:"55"},!0,e)?(r._flag="chrome",r._handlerClass=a.default):o.default.check({firefox:"59"},!0,e)?(r._flag="firefox",r._handlerClass=u.default):o.default.check({firefox:"50"},!0,e)?(r._flag="firefox",r._handlerClass=c.default):o.default.check({safari:"11"},!0,e)?(r._flag="safari",r._handlerClass=s.default):o.default.check({msedge:"11"},!0,e)&&(r._flag="msedge",r._handlerClass=d.default),o.default.check({opera:"44"},!0,e)&&(r._flag="opera",r._handlerClass=a.default),r.isSupported()?p.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',r._flag,r._name,r._version,r._handlerClass.tag):p.warn("browser not supported [name:%s, version:%s]",r._name,r._version)}else p.warn("device not supported")}},{key:"Handler",get:function(){return r._detected||r._detect(),r._handlerClass}}]),r}();(h.default=f)._detected=!1,f._flag=void 0,f._name=void 0,f._version=void 0,f._bowser=void 0,f._handlerClass=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":5,"./handlers/Chrome55":11,"./handlers/Chrome67":12,"./handlers/Edge11":13,"./handlers/Firefox50":14,"./handlers/Firefox59":15,"./handlers/ReactNative":16,"./handlers/Safari11":17,bowser:27}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=e("events"),i=e("./Logger"),s=(n=i)&&n.__esModule?n:{default:n};var c=function(e){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.setMaxListeners(1/0),t._logger=e||new s.default("EnhancedEventEmitter"),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,a.EventEmitter),o(r,[{key:"safeEmit",value:function(t){try{for(var e=arguments.length,r=Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];this.emit.apply(this,[t].concat(r))}catch(e){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e)}}},{key:"safeEmitAsPromise",value:function(n){for(var o=this,e=arguments.length,a=Array(1<e?e-1:0),t=1;t<e;t++)a[t-1]=arguments[t];return new Promise(function(t,r){o.safeEmit.apply(o,[n].concat(a,[function(e){t(e)},function(e){o._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",n,e),r(e)}]))})}}]),r}();r.default=c},{"./Logger":5,events:30}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=e("debug"),i=(n=a)&&n.__esModule?n:{default:n};var s="mediasoup-client",c=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e?(this._debug=(0,i.default)(s+":"+e),this._warn=(0,i.default)(s+":WARN:"+e),this._error=(0,i.default)(s+":ERROR:"+e)):(this._debug=(0,i.default)(s),this._warn=(0,i.default)(s+":WARN"),this._error=(0,i.default)(s+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return o(t,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),t}();r.default=c},{debug:28}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),n=i(e("./Logger")),a=i(e("./EnhancedEventEmitter"));function i(e){return e&&e.__esModule?e:{default:e}}var s=new n.default("Peer"),c=function(e){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,s));return r._name=e,r._closed=!1,r._appData=t,r._consumers=new Map,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,a.default),o(n,[{key:"close",value:function(){if(s.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(s.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._consumers.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:"+e.id+"]");this._consumers.set(e.id,e),e.on("@close",function(){t._consumers.delete(e.id)}),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}]),n}();r.default=c},{"./EnhancedEventEmitter":4,"./Logger":5}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=u(e("./Logger")),i=u(e("./EnhancedEventEmitter")),s=e("./errors"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils"));function u(e){return e&&e.__esModule?e:{default:e}}var d={low:1e5,medium:3e5,high:15e5},l=new o.default("Producer"),p=function(e){function o(t,e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,l));n._id=c.randomNumber(),n._closed=!1,n._originalTrack=t;try{n._track=t.clone()}catch(e){n._track=t}return n._appData=r,n._simulcast=!1,"object"===a(e.simulcast)?n._simulcast=Object.assign({},d,e.simulcast):!0===e.simulcast&&(n._simulcast=Object.assign({},d)),n._transport=null,n._rtpParameters=null,n._locallyPaused=!n._track.enabled,n._remotelyPaused=!1,n._statsEnabled=!1,n._statsInterval=1e3,n._handleTrack(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,i.default),n(o,[{key:"close",value:function(e){l.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){l.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return l.debug("send() [transport:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":a(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e).addProducer(this).then(function(){e.once("@close",function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))}),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)}).catch(function(e){throw t._transport=null,e})}},{key:"pause",value:function(e){return l.debug("pause()"),this._closed?(l.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){l.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return l.debug("resume()"),this._closed?(l.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){l.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(t){var e=this;if(l.debug("replaceTrack() [track:%o]",t),this._closed)return Promise.reject(new s.InvalidStateError("Producer closed"));if(!(t instanceof MediaStreamTrack))return Promise.reject(new TypeError("track is not a MediaStreamTrack"));if("ended"===t.readyState)return Promise.reject(new Error('track.readyState is "ended"'));var r=void 0;try{r=t.clone()}catch(e){r=t}return Promise.resolve().then(function(){if(e._transport)return e._transport.replaceProducerTrack(e,r)}).then(function(){try{e._track.onended=null,e._track.stop()}catch(e){}return e.paused?r.enabled=!1:r.enabled=!0,e._originalTrack=t,e._track=r,e._handleTrack(),e._track})}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;l.debug("enableStats() [interval:%s]",e),this._closed?l.error("enableStats() | Producer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){l.debug("disableStats()"),this._closed?l.error("disableStats() | Producer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(l.warn('track "ended" event'),e.safeEmit("trackended"))}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}]),o}();r.default=p},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":26}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=m(e("./Logger")),i=m(e("./EnhancedEventEmitter")),c=e("./errors"),u=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./ortc")),d=m(e("./Device")),s=m(e("./Transport")),l=m(e("./Producer")),p=m(e("./Peer")),f=m(e("./Consumer"));function m(e){return e&&e.__esModule?e:{default:e}}var v=new a.default("Room"),h="new",y="joining",_="joined",g="closed",b=function(e){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,v));if(v.debug("constructor() [options:%o]",e),!d.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},t._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||1e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[]},t._state=h,t._peerName=null,t._transports=new Map,t._producers=new Map,t._peers=new Map,t._extendedRtpCapabilities=null,t._canSendByKind={audio:!1,video:!1},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,i.default),o(r,[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,o){var s=this;if(v.debug('join() [peerName:"%s"]',e),"string"!=typeof e)return Promise.reject(new TypeError("invalid peerName"));if(this._state!==h&&this._state!==g)return Promise.reject(new c.InvalidStateError('invalid state "'+this._state+'"'));this._peerName=e,this._state=y;var a=void 0;return Promise.resolve().then(function(){return s._settings.roomSettings?void(a=s._settings.roomSettings):s._sendRequest("queryRoom",{target:"room"}).then(function(e){a=e,v.debug("join() | got Room settings:%o",a)})}).then(function(){return d.default.Handler.getNativeRtpCapabilities()}).then(function(e){v.debug("join() | native RTP capabilities:%o",e),s._extendedRtpCapabilities=u.getExtendedRtpCapabilities(e,a.rtpCapabilities),v.debug("join() | extended RTP capabilities:%o",s._extendedRtpCapabilities);var t=u.getUnsupportedCodecs(a.rtpCapabilities,a.mandatoryCodecPayloadTypes,s._extendedRtpCapabilities);if(0<t.length)throw v.error("%s mandatory room codecs not supported:%o",t.length,t),new c.UnsupportedError("mandatory room codecs not supported",t);s._canSendByKind.audio=u.canSend("audio",s._extendedRtpCapabilities),s._canSendByKind.video=u.canSend("video",s._extendedRtpCapabilities);var r=u.getRtpCapabilities(s._extendedRtpCapabilities);v.debug("join() | effective local RTP capabilities for receiving:%o",r);var n={target:"room",peerName:s._peerName,rtpCapabilities:r,appData:o};return s._sendRequest("join",n).then(function(e){return e.peers})}).then(function(e){var t=!0,r=!1,n=void 0;try{for(var o,a=(e||[])[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value;try{s._handlePeerData(i)}catch(e){v.error("join() | error handling Peer:%o",e)}}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}return s._state=_,v.debug("join() | joined the Room"),s.peers}).catch(function(e){throw s._state=h,e})}},{key:"leave",value:function(e){if(v.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=g,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.close()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){u.value.close()}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){m.value.close()}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}}}},{key:"remoteClose",value:function(e){if(v.debug("remoteClose()"),!this.closed){this._state=g,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){u.value.remoteClose()}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){m.value.remoteClose()}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}}}},{key:"canSend",value:function(e){if(!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'+e+'"');return this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var o=this;if(v.debug("createTransport() [direction:%s]",e),!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'+e+'"');var r=new s.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(r.id,r),r.on("@request",function(e,t,r,n){o._sendRequest(e,t).then(r).catch(n)}),r.on("@notify",function(e,t){o._sendNotification(e,t)}),r.on("@close",function(){o._transports.delete(r.id)}),r}},{key:"createProducer",value:function(e,t,r){var n=this;if(v.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');if(!(e instanceof MediaStreamTrack))throw new TypeError("track is not a MediaStreamTrack");if(!this._canSendByKind[e.kind])throw new Error("cannot send "+e.kind);if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new l.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",function(){n._producers.delete(o.id)}),o}},{key:"restartIce",value:function(){if(!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.restartIce()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"receiveNotification",value:function(ne){var oe=this;if(this.closed)return Promise.reject(new c.InvalidStateError("Room closed"));if("object"!==(void 0===ne?"undefined":n(ne)))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==ne.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof ne.method)return Promise.reject(new TypeError("wrong/missing notification method"));var ae=ne.method;return v.debug("receiveNotification() [method:%s, notification:%o]",ae,ne),Promise.resolve().then(function(){switch(ae){case"closed":var e=ne.appData;oe.remoteClose(e);break;case"transportClosed":var t=ne.id,r=ne.appData,n=oe._transports.get(t);if(!n)throw new Error('Transport not found [id:"'+t+'"]');n.remoteClose(r);break;case"transportStats":var o=ne.id,a=ne.stats,i=oe._transports.get(o);if(!i)throw new Error("transport not found [id:"+o+"]");i.remoteStats(a);break;case"newPeer":var s=ne.name;if(oe._peers.has(s))throw new Error('Peer already exists [name:"'+s+'"]');var c=ne;oe._handlePeerData(c);break;case"peerClosed":var u=ne.name,d=ne.appData,l=oe._peers.get(u);if(!l)throw new Error('no Peer found [name:"'+u+'"]');l.remoteClose(d);break;case"producerPaused":var p=ne.id,f=ne.appData,m=oe._producers.get(p);if(!m)throw new Error("Producer not found [id:"+p+"]");m.remotePause(f);break;case"producerResumed":var h=ne.id,v=ne.appData,y=oe._producers.get(h);if(!y)throw new Error("Producer not found [id:"+h+"]");y.remoteResume(v);break;case"producerClosed":var _=ne.id,g=ne.appData,b=oe._producers.get(_);if(!b)throw new Error("Producer not found [id:"+_+"]");b.remoteClose(g);break;case"producerStats":var w=ne.id,P=ne.stats,k=oe._producers.get(w);if(!k)throw new Error("Producer not found [id:"+w+"]");k.remoteStats(P);break;case"newConsumer":var S=ne.peerName,T=oe._peers.get(S);if(!T)throw new Error('no Peer found [name:"'+S+'"]');var C=ne;oe._handleConsumerData(C,T);break;case"consumerClosed":var R=ne.id,E=ne.peerName,x=ne.appData,O=oe._peers.get(E);if(!O)throw new Error('no Peer found [name:"'+E+'"]');var I=O.getConsumerById(R);if(!I)throw new Error("Consumer not found [id:"+R+"]");I.remoteClose(x);break;case"consumerPaused":var D=ne.id,j=ne.peerName,L=ne.appData,F=oe._peers.get(j);if(!F)throw new Error('no Peer found [name:"'+j+'"]');var A=F.getConsumerById(D);if(!A)throw new Error("Consumer not found [id:"+D+"]");A.remotePause(L);break;case"consumerResumed":var M=ne.id,N=ne.peerName,B=ne.appData,U=oe._peers.get(N);if(!U)throw new Error('no Peer found [name:"'+N+'"]');var q=U.getConsumerById(M);if(!q)throw new Error("Consumer not found [id:"+M+"]");q.remoteResume(B);break;case"consumerPreferredProfileSet":var z=ne.id,G=ne.peerName,K=ne.profile,V=oe._peers.get(G);if(!V)throw new Error('no Peer found [name:"'+G+'"]');var W=V.getConsumerById(z);if(!W)throw new Error("Consumer not found [id:"+z+"]");W.remoteSetPreferredProfile(K);break;case"consumerEffectiveProfileChanged":var Q=ne.id,$=ne.peerName,J=ne.profile,H=oe._peers.get($);if(!H)throw new Error('no Peer found [name:"'+$+'"]');var X=H.getConsumerById(Q);if(!X)throw new Error("Consumer not found [id:"+Q+"]");X.remoteEffectiveProfileChanged(J);break;case"consumerStats":var Z=ne.id,Y=ne.peerName,ee=ne.stats,te=oe._peers.get(Y);if(!te)throw new Error('no Peer found [name:"'+Y+'"]');var re=te.getConsumerById(Z);if(!re)throw new Error("Consumer not found [id:"+Z+"]");re.remoteStats(ee);break;default:throw new Error('unknown notification method "'+ae+'"')}}).catch(function(e){v.error("receiveNotification() failed [notification:%o]: %s",ne,e)})}},{key:"_sendRequest",value:function(a,e){var i=this,s=Object.assign({method:a,target:"peer"},e);return this.closed?(v.error("_sendRequest() | Room closed [method:%s, request:%o]",a,s),Promise.reject(new c.InvalidStateError("Room closed"))):(v.debug("_sendRequest() [method:%s, request:%o]",a,s),new Promise(function(t,r){var n=!1,o=setTimeout(function(){v.error("request failed [method:%s]: timeout",a),n=!0,r(new c.TimeoutError("timeout"))},i._settings.requestTimeout);i.safeEmit("request",s,function(e){if(!n){if(n=!0,clearTimeout(o),i.closed)return v.error("request failed [method:%s]: Room closed",a),void r(new Error("Room closed"));v.debug("request succeeded [method:%s, response:%o]",a,e),t(e)}},function(e){if(!n){if(n=!0,clearTimeout(o),i.closed)return v.error("request failed [method:%s]: Room closed",a),void r(new Error("Room closed"));e instanceof Error||(e=new Error(String(e))),v.error("request failed [method:%s]:%o",a,e),r(e)}})}))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);v.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,a=new p.default(r,o);this._peers.set(a.name,a),a.on("@close",function(){t._peers.delete(a.name)});var i=!0,s=!1,c=void 0;try{for(var u,d=n[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{this._handleConsumerData(l,a)}catch(e){v.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",a)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,a=e.paused,i=e.appData,s=new f.default(r,n,o,t,i);u.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),a&&s.remotePause(),t.addConsumer(s)}},{key:"joined",get:function(){return this._state===_}},{key:"closed",get:function(){return this._state===g}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}]),r}();r.default=b},{"./Consumer":2,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./Peer":6,"./Producer":7,"./Transport":9,"./errors":10,"./ortc":25}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=a(e("./Logger")),i=a(e("./EnhancedEventEmitter")),s=e("./errors"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils")),u=a(e("./Device")),d=a(e("./CommandQueue"));function a(e){return e&&e.__esModule?e:{default:e}}var l=new o.default("Transport"),p=function(e){function a(e,t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,l));return l.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t),o._id=c.randomNumber(),o._closed=!1,o._direction=e,o._settings=r,o._appData=n,o._statsEnabled=!1,o._commandQueue=new d.default,o._handler=new u.default.Handler(e,t,r),o._connectionState="new",o._commandQueue.on("exec",o._execCommand.bind(o)),o._handleHandler(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,i.default),n(a,[{key:"close",value:function(e){l.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e){l.debug("remoteClose()"),this._closed||(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var r=this;l.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then(function(){var e={id:r._id};return r.safeEmitAsPromise("@request","restartTransport",e)}).then(function(e){var t=e.iceParameters;return r._commandQueue.push("restartIce",{remoteIceParameters:t})}).catch(function(e){l.error("restartIce() | failed: %o",e)})}},{key:"enableStats",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;l.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){l.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var o=this,e=this._handler;e.on("@connectionstatechange",function(e){o._connectionState!==e&&(l.debug("Transport connection state changed to %s",e),o._connectionState=e,o._closed||o.safeEmit("connectionstatechange",e))}),e.on("@needcreatetransport",function(e,t,r){var n={id:o._id,direction:o._direction,options:o._settings.transportOptions,appData:o._appData};e&&(n.dtlsParameters=e.dtlsParameters),o.safeEmit("@request","createTransport",n,t,r)}),e.on("@needupdatetransport",function(e){var t={id:o._id,dtlsParameters:e.dtlsParameters};o.safeEmit("@notify","updateTransport",t)}),e.on("@needupdateproducer",function(e,t){var r={id:e.id,rtpParameters:t};e.setRtpParameters(t),o.safeEmit("@notify","updateProducer",r)})}},{key:"addProducer",value:function(e){return l.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){l.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch(function(){}),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){l.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){l.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return l.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){l.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){l.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return l.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){l.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch(function(){})}},{key:"pauseConsumer",value:function(e,t){l.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){l.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){l.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){l.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){l.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r=void 0;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var a=e.producer,i=e.track;r=this._execReplaceProducerTrack(a,i);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'+e.method+'"'))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(r){var n=this;l.debug("_execAddProducer()");var o=void 0;return Promise.resolve().then(function(){return n._handler.addProducer(r)}).then(function(e){o=e;var t={id:r.id,kind:r.kind,transportId:n._id,rtpParameters:e,paused:r.locallyPaused,appData:r.appData};return n.safeEmitAsPromise("@request","createProducer",t)}).then(function(){r.setRtpParameters(o)})}},{key:"_execRemoveProducer",value:function(e){return l.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return l.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(o){var r=this;l.debug("_execAddConsumer()");var a=void 0;return Promise.resolve().then(function(){return r._handler.addConsumer(o)}).then(function(e){a=e;var t={id:o.id,transportId:r.id,paused:o.locallyPaused,preferredProfile:o.preferredProfile};return r.safeEmitAsPromise("@request","enableConsumer",t)}).then(function(e){var t=e.paused,r=e.preferredProfile,n=e.effectiveProfile;return t&&o.remotePause(),r&&o.remoteSetPreferredProfile(r),n&&o.remoteEffectiveProfileChanged(n),a})}},{key:"_execRemoveConsumer",value:function(e){return l.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return l.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}}]),a}();r.default=p},{"./CommandQueue":1,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":26}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s,c,u,d,l=(s=Object,c=s.getPrototypeOf||function(e){return e.__proto__},u=s.setPrototypeOf||function(e,t){return e.__proto__=t,e},d="object"===("undefined"==typeof Reflect?"undefined":n(Reflect))?Reflect.construct:function(e,t,r){var n,o=[null];return o.push.apply(o,t),n=e.bind.apply(e,o),u(new n,r.prototype)},function(e){var t=c(e);return u(e,u(function(){return d(t,arguments,c(this).constructor)},t))}),p=r.InvalidStateError=l(function(e){function r(e){o(this,r);var t=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(t,r):t.stack=new Error(e).stack,t}return i(r,Error),r}());r.TimeoutError=l(function(e){function r(e){o(this,r);var t=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.name="TimeoutError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(t,p):t.stack=new Error(e).stack,t}return i(r,Error),r}()),r.UnsupportedError=l(function(e){function n(e,t){o(this,n);var r=a(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return r.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,p):r.stack=new Error(e).stack,r.data=t,r}return i(n,Error),n}())},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=f(e("sdp-transform")),n=f(e("../Logger")),s=f(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/planBUtils")),p=f(e("./sdp/RemotePlanBSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Chrome55"),_=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new p.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),a(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),g=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r}return v(n,_),a(n,[{key:"addProducer",value:function(r){var n=this,o=r.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",r.id,r.kind,o.id),this._stream.getTrackById(o.id))return Promise.reject(new Error("track already added"));var t=void 0;return Promise.resolve().then(function(){return n._stream.addTrack(o),n._pc.addStream(n._stream),n._pc.createOffer()}).then(function(e){if(r.simulcast){y.debug("addProducer() | enabling simulcast");var t=i.default.parse(e.sdp);l.addSimulcastForTrack(t,o),e={type:"offer",sdp:i.default.write(t)}}return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),n._pc.setLocalDescription(e)}).then(function(){if(!n._transportReady)return n._setupTransport()}).then(function(){t=i.default.parse(n._pc.localDescription.sdp);var e={type:"answer",sdp:n._remoteSdp.createAnswerSdp(t)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),n._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(n._rtpParametersByKind[r.kind]);return l.fillRtpParametersForTrack(e,t,o),e}).catch(function(e){throw n._stream.removeTrack(o),n._pc.addStream(n._stream),e})}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){return r._stream.removeTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).catch(function(e){if(0!==r._stream.getTracks().length)throw e;y.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==r._pc.signalingState){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)}})}},{key:"replaceProducerTrack",value:function(r,n){var o=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",r.id,r.kind,n.id);var t=r.track,a=void 0;return Promise.resolve().then(function(){return o._stream.removeTrack(t),o._stream.addTrack(n),o._pc.addStream(o._stream),o._pc.createOffer()}).then(function(e){if(r.simulcast){y.debug("addProducer() | enabling simulcast");var t=i.default.parse(e.sdp);l.addSimulcastForTrack(t,n),e={type:"offer",sdp:i.default.write(t)}}return y.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){a=i.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(a)};return y.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(o._rtpParametersByKind[r.kind]);l.fillRtpParametersForTrack(e,a,n),o.safeEmit("@needupdateproducer",r,e)}).catch(function(e){throw o._stream.removeTrack(n),o._stream.addTrack(t),o._pc.addStream(o._stream),e})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=i.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));return r._transportCreated=!1,r._transportUpdated=!1,r._kinds=new Set,r._consumerInfos=new Map,r}return v(n,_),a(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=i.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new g(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return a(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){try{r.close()}catch(e){}var t=i.default.parse(e.sdp);return d.extractRtpCapabilities(t)}).catch(function(e){try{r.close()}catch(e){}throw e})}},{key:"tag",get:function(){return"Chrome55"}}]),o}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":25,"../utils":26,"./sdp/RemotePlanBSdp":19,"./sdp/commonUtils":21,"./sdp/planBUtils":22,"sdp-transform":35}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=f(e("sdp-transform")),n=f(e("../Logger")),s=f(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/planBUtils")),p=f(e("./sdp/RemotePlanBSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Chrome67"),_=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new p.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),a(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),g=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r}return v(n,_),a(n,[{key:"addProducer",value:function(r){var n=this,o=r.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",r.id,r.kind,o.id),this._stream.getTrackById(o.id))return Promise.reject(new Error("track already added"));var t=void 0;return Promise.resolve().then(function(){return n._stream.addTrack(o),n._pc.addStream(n._stream),n._pc.createOffer()}).then(function(e){if(r.simulcast){y.debug("addProducer() | enabling simulcast");var t=i.default.parse(e.sdp);l.addSimulcastForTrack(t,o),e={type:"offer",sdp:i.default.write(t)}}return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),n._pc.setLocalDescription(e)}).then(function(){if(!n._transportReady)return n._setupTransport()}).then(function(){t=i.default.parse(n._pc.localDescription.sdp);var e={type:"answer",sdp:n._remoteSdp.createAnswerSdp(t)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),n._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(n._rtpParametersByKind[r.kind]);return l.fillRtpParametersForTrack(e,t,o),e}).catch(function(e){throw n._stream.removeTrack(o),n._pc.addStream(n._stream),e})}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){return r._stream.removeTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).catch(function(e){if(0!==r._stream.getTracks().length)throw e;y.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==r._pc.signalingState){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=i.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));return r._transportCreated=!1,r._transportUpdated=!1,r._kinds=new Set,r._consumerInfos=new Map,r}return v(n,_),a(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=i.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new g(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return a(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){try{r.close()}catch(e){}var t=i.default.parse(e.sdp);return d.extractRtpCapabilities(t)}).catch(function(e){try{r.close()}catch(e){}throw e})}},{key:"tag",get:function(){return"Chrome67"}}]),o}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":25,"../utils":26,"./sdp/RemotePlanBSdp":19,"./sdp/commonUtils":21,"./sdp/planBUtils":22,"sdp-transform":35}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=d(e("../Logger")),a=d(e("../EnhancedEventEmitter")),s=u(e("../utils")),i=u(e("../ortc")),c=u(e("./ortc/edgeUtils"));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}var l="CNAME-EDGE-"+s.randomNumber(),p=new o.default("Edge11"),f=function(e){function o(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,p));return p.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t),n._rtpParametersByKind={audio:i.getSendingRtpParameters("audio",t),video:i.getSendingRtpParameters("video",t)},n._transportReady=!1,n._iceGatherer=null,n._iceTransport=null,n._dtlsTransport=null,n._rtpSenders=new Map,n._rtpReceivers=new Map,n._transportRemoteParameters=null,n._setIceGatherer(r),n._setIceTransport(),n._setDtlsTransport(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,a.default),n(o,null,[{key:"getNativeRtpCapabilities",value:function(){return p.debug("getNativeRtpCapabilities()"),c.getCapabilities()}},{key:"tag",get:function(){return"Edge11"}}]),n(o,[{key:"close",value:function(){p.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;try{a.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}}},{key:"addProducer",value:function(o){var a=this,i=o.track;return p.debug("addProducer() [id:%s, kind:%s, trackId:%s]",o.id,o.kind,i.id),this._rtpSenders.has(o.id)?Promise.reject(new Error("Producer already added")):Promise.resolve().then(function(){if(!a._transportReady)return a._setupTransport()}).then(function(){p.debug("addProducer() | calling new RTCRtpSender()");var e=new RTCRtpSender(i,a._dtlsTransport),t=s.clone(a._rtpParametersByKind[o.kind]),r={ssrc:s.randomNumber()};t.codecs.some(function(e){return"rtx"===e.name})&&(r.rtx={ssrc:s.randomNumber()}),t.encodings.push(r),t.rtcp={cname:l,reducedSize:!0,mux:!0};var n=c.mangleRtpParameters(t);return p.debug("addProducer() | calling rtpSender.send() [params:%o]",n),e.send(n),a._rtpSenders.set(o.id,e),t})}},{key:"removeProducer",value:function(t){var r=this,e=t.track;return p.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,e.id),Promise.resolve().then(function(){var e=r._rtpSenders.get(t.id);if(!e)throw new Error("RTCRtpSender not found");r._rtpSenders.delete(t.id);try{p.debug("removeProducer() | calling rtpSender.stop()"),e.stop()}catch(e){p.warn("rtpSender.stop() failed:%o",e)}})}},{key:"replaceProducerTrack",value:function(t,r){var n=this;return p.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,r.id),Promise.resolve().then(function(){var e=n._rtpSenders.get(t.id);if(!e)throw new Error("RTCRtpSender not found");e.setTrack(r)})}},{key:"addConsumer",value:function(r){var n=this;return p.debug("addConsumer() [id:%s, kind:%s]",r.id,r.kind),this._rtpReceivers.has(r.id)?Promise.reject(new Error("Consumer already added")):Promise.resolve().then(function(){if(!n._transportReady)return n._setupTransport()}).then(function(){p.debug("addProducer() | calling new RTCRtpReceiver()");var e=new RTCRtpReceiver(n._dtlsTransport,r.kind);e.addEventListener("error",function(e){p.error('iceGatherer "error" event [event:%o]',e)});var t=c.mangleRtpParameters(r.rtpParameters);return p.debug("addProducer() | calling rtpReceiver.receive() [params:%o]",t),e.receive(t),n._rtpReceivers.set(r.id,e),e.track})}},{key:"removeConsumer",value:function(t){var r=this;return p.debug("removeConsumer() [id:%s, kind:%s]",t.id,t.kind),Promise.resolve().then(function(){var e=r._rtpReceivers.get(t.id);if(!e)throw new Error("RTCRtpReceiver not found");r._rtpReceivers.delete(t.id);try{p.debug("removeConsumer() | calling rtpReceiver.stop()"),e.stop()}catch(e){p.warn("rtpReceiver.stop() failed:%o",e)}})}},{key:"restartIce",value:function(s){var c=this;p.debug("restartIce()"),Promise.resolve().then(function(){c._transportRemoteParameters.iceParameters=s;var e=c._transportRemoteParameters.iceCandidates;p.debug("restartIce() | calling iceTransport.start()"),c._iceTransport.start(c._iceGatherer,s,"controlling");var t=!0,r=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value;c._iceTransport.addRemoteCandidate(i)}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}c._iceTransport.addRemoteCandidate({})})}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:"all"});t.addEventListener("error",function(e){p.error('iceGatherer "error" event [event:%o]',e)});try{t.gather()}catch(e){p.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("icestatechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("candidatepairchange",function(e){p.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",function(){p.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",function(){p.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state)}),e.addEventListener("error",function(e){p.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}},{key:"_setupTransport",value:function(){var d=this;return p.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=d._dtlsTransport.getLocalParameters();return t.role="server",e.dtlsParameters=t,d.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){var t=(d._transportRemoteParameters=e).iceParameters,r=e.iceCandidates,n=e.dtlsParameters;d._iceTransport.start(d._iceGatherer,t,"controlling");var o=!0,a=!1,i=void 0;try{for(var s,c=r[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;d._iceTransport.addRemoteCandidate(u)}}catch(e){a=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw i}}d._iceTransport.addRemoteCandidate({}),n.fingerprints=n.fingerprints.filter(function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm}),d._dtlsTransport.start(n),d._transportReady=!0})}}]),o}();r.default=f},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":25,"../utils":26,"./ortc/edgeUtils":18}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=f(e("sdp-transform")),n=f(e("../Logger")),s=f(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/unifiedPlanUtils")),p=f(e("./sdp/RemoteUnifiedPlanSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Firefox50"),_=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new p.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),a(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),g=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r._nextRid=1,r}return v(n,_),a(n,[{key:"addProducer",value:function(t){var r=this,n=t.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,n.id),this._stream.getTrackById(n.id))return Promise.reject(new Error("track already added"));var o=void 0,a=void 0;return Promise.resolve().then(function(){r._stream.addTrack(n),o=r._pc.addTrack(n,r._stream)}).then(function(){if(t.simulcast){y.debug("addProducer() | enabling simulcast");var e=[];return t.simulcast.high&&e.push({rid:"high"+r._nextRid,active:!0,priority:"high",maxBitrate:t.simulcast.high}),t.simulcast.medium&&e.push({rid:"medium"+r._nextRid,active:!0,priority:"medium",maxBitrate:t.simulcast.medium}),t.simulcast.low&&e.push({rid:"low"+r._nextRid,active:!0,priority:"low",maxBitrate:t.simulcast.low}),r._nextRid++,o.setParameters({encodings:e})}}).then(function(){return r._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){a=i.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(a)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(r._rtpParametersByKind[t.kind]);return l.fillRtpParametersForTrack(e,a,n),e}).catch(function(e){try{r._pc.removeTrack(o)}catch(e){}throw r._stream.removeTrack(n),e})}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===t});if(!e)throw new Error("RTCRtpSender found");return r._pc.removeTrack(e),r._stream.removeTrack(t),Promise.resolve().then(function(){return r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)})}).then(function(){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=i.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));r._transportCreated=!1,r._transportUpdated=!1,r._consumerInfos=new Map;return r._consumerInfos.set(555,{mid:"fake-dc",kind:"application",closed:!1,cname:null}),r}return v(n,_),a(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=i.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new g(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return a(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n=document.createElement("canvas");n.getContext("2d");var e=n.captureStream(),t=e.getVideoTracks()[0];return r.addTrack(t,e).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){try{n.remove()}catch(e){}try{r.close()}catch(e){}var t=i.default.parse(e.sdp);return d.extractRtpCapabilities(t)}).catch(function(e){try{n.remove()}catch(e){}try{r.close()}catch(e){}throw e})}},{key:"tag",get:function(){return"Firefox50"}}]),o}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":25,"../utils":26,"./sdp/RemoteUnifiedPlanSdp":20,"./sdp/commonUtils":21,"./sdp/unifiedPlanUtils":23,"sdp-transform":35}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=f(e("sdp-transform")),n=f(e("../Logger")),s=f(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/unifiedPlanUtils")),p=f(e("./sdp/RemoteUnifiedPlanSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Firefox59"),_=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new p.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),a(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),g=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r._nextRid=1,r}return v(n,_),a(n,[{key:"addProducer",value:function(t){var r=this,n=t.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,n.id),this._stream.getTrackById(n.id))return Promise.reject(new Error("track already added"));var o=void 0,a=void 0;return Promise.resolve().then(function(){r._stream.addTrack(n),o=r._pc.addTrack(n,r._stream)}).then(function(){if(t.simulcast){y.debug("addProducer() | enabling simulcast");var e=[];return t.simulcast.high&&e.push({rid:"high"+r._nextRid,active:!0,priority:"high",maxBitrate:t.simulcast.high}),t.simulcast.medium&&e.push({rid:"medium"+r._nextRid,active:!0,priority:"medium",maxBitrate:t.simulcast.medium}),t.simulcast.low&&e.push({rid:"low"+r._nextRid,active:!0,priority:"low",maxBitrate:t.simulcast.low}),r._nextRid++,o.setParameters({encodings:e})}}).then(function(){return r._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){a=i.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(a)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(r._rtpParametersByKind[t.kind]);return l.fillRtpParametersForTrack(e,a,n),e}).catch(function(e){try{r._pc.removeTrack(o)}catch(e){}throw r._stream.removeTrack(n),e})}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===t});if(!e)throw new Error("RTCRtpSender found");return r._pc.removeTrack(e),r._stream.removeTrack(t),Promise.resolve().then(function(){return r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)})}).then(function(){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=i.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));return r._transportCreated=!1,r._transportUpdated=!1,r._consumerInfos=new Map,r}return v(n,_),a(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:""+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getTransceivers().find(function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===o.mid)});if(!e)throw new Error("remote track not found");return e.receiver.track})}},{key:"removeConsumer",value:function(e){var t=this;y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=i.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new g(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return a(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n=document.createElement("canvas");n.getContext("2d");var e=n.captureStream(),t=e.getVideoTracks()[0];return r.addTrack(t,e).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){try{n.remove()}catch(e){}try{r.close()}catch(e){}var t=i.default.parse(e.sdp);return d.extractRtpCapabilities(t)}).catch(function(e){try{n.remove()}catch(e){}try{r.close()}catch(e){}throw e})}},{key:"tag",get:function(){return"Firefox59"}}]),o}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":25,"../utils":26,"./sdp/RemoteUnifiedPlanSdp":20,"./sdp/commonUtils":21,"./sdp/unifiedPlanUtils":23,"sdp-transform":35}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),s=f(e("sdp-transform")),n=f(e("../Logger")),o=f(e("../EnhancedEventEmitter")),c=p(e("../utils")),a=p(e("../ortc")),u=p(e("./sdp/commonUtils")),d=p(e("./sdp/planBUtils")),l=f(e("./sdp/RemotePlanBSdp"));function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("ReactNative"),_=function(e){function a(e,t,r,n){m(this,a);var o=h(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=t,o._remoteSdp=new l.default(e,t),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o._pc.onnegotiationneeded=function(){n&&o.createOffer()},o}return v(a,o.default),i(a,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}},{key:"createOffer",value:function(){var t=this;this._pc.createOffer().then(function(e){return t._pc.setLocalDescription(e)}).catch(function(e){y.error(e)})}}]),a}(),g=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t,!0));return r._transportReady=!1,r._tracks=new Set,r}return v(n,_),i(n,[{key:"addProducer",value:function(n){var o=this,a=n.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",n.id,n.kind,a.id),this._tracks.has(a))return Promise.reject(new Error("track already added"));if(!a.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var t=void 0,r=void 0;return Promise.resolve().then(function(){return o._tracks.add(a),(t=new MediaStream(a.streamReactTag)).addTrack(a),o._pc.addStream(t),o._pc.createOffer()}).then(function(e){if(n.simulcast){y.debug("addProducer() | enabling simulcast");var t=s.default.parse(e.sdp);d.addSimulcastForTrack(t,a),e={type:"offer",sdp:s.default.write(t)}}y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return o._pc.setLocalDescription(r)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=s.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return o._pc.setRemoteDescription(t)}).then(function(){var e=c.clone(o._rtpParametersByKind[n.kind]);return d.fillRtpParametersForTrack(e,r,a),e}).catch(function(e){throw o._tracks.delete(a),t.removeTrack(a),o._pc.addStream(t),e})}},{key:"removeProducer",value:function(e){var n=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),t.streamReactTag?Promise.resolve().then(function(){n._tracks.delete(t);var e=new MediaStream(t.streamReactTag);return e.addTrack(t),n._pc.addStream(e),n._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),n._pc.setLocalDescription(e)}).catch(function(e){if(0!==n._tracks.size)throw e;y.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==n._pc.signalingState){var e=s.default.parse(n._pc.localDescription.sdp),t={type:"answer",sdp:n._remoteSdp.createAnswerSdp(e)};y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t);var r=new RTCSessionDescription(t);return n._pc.setRemoteDescription(r)}}):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"replaceProducerTrack",value:function(n,o){var a=this;if(y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",n.id,n.kind,o.id),!o.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var e=n.track,t=void 0,r=void 0;return Promise.resolve().then(function(){return a._tracks.add(o),a._tracks.delete(e),(t=new MediaStream(o.streamReactTag)).addTrack(o),t.removeTrack(e),a._pc.addStream(t),a._pc.createOffer()}).then(function(e){if(n.simulcast){y.debug("addProducer() | enabling simulcast");var t=s.default.parse(e.sdp);d.addSimulcastForTrack(t,o),e={type:"offer",sdp:s.default.write(t)}}y.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return a._pc.setLocalDescription(r)}).then(function(){r=s.default.parse(a._pc.localDescription.sdp);var e={type:"answer",sdp:a._remoteSdp.createAnswerSdp(r)};y.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return a._pc.setRemoteDescription(t)}).then(function(){var e=c.clone(a._rtpParametersByKind[n.kind]);d.fillRtpParametersForTrack(e,r,o),a.safeEmit("@needupdateproducer",n,e)}).catch(function(e){throw a._tracks.delete(o),t.removeTrack(o),a._pc.addStream(t),e})}},{key:"restartIce",value:function(e){var n=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return n._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),n._pc.setLocalDescription(e)}).then(function(){var e=s.default.parse(n._pc.localDescription.sdp),t={type:"answer",sdp:n._remoteSdp.createAnswerSdp(e)};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t);var r=new RTCSessionDescription(t);return n._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=s.default.parse(t),n=u.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t,!1));return r._transportCreated=!1,r._transportUpdated=!1,r._kinds=new Set,r._consumerInfos=new Map,r}return v(n,_),i(n,[{key:"addConsumer",value:function(e){var r=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var t=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:t.ssrc,cname:n};return t.rtx&&t.rtx.ssrc&&(o.rtxSsrc=t.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!r._transportCreated)return r._setupTransport()}).then(function(){var e={type:"offer",sdp:r._remoteSdp.createOfferSdp(Array.from(r._kinds),Array.from(r._consumerInfos.values()))};y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)}).then(function(){return r._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){if(!r._transportUpdated)return r._updateTransport()}).then(function(){var e=r._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}),t=e.getTrackById(o.trackId);if(t.streamReactTag=e.reactTag,!t)throw new Error("remote track not found");return t})}},{key:"removeConsumer",value:function(e){var r=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:r._remoteSdp.createOfferSdp(Array.from(r._kinds),Array.from(r._consumerInfos.values()))};y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)}).then(function(){return r._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),r._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:r._remoteSdp.createOfferSdp(Array.from(r._kinds),Array.from(r._consumerInfos.values()))};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)}).then(function(){return r._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),r._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=s.default.parse(e),r={dtlsParameters:u.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:a.getSendingRtpParameters("audio",t),video:a.getSendingRtpParameters("video",t)},new g(n,r);case"recv":return n={audio:a.getReceivingFullRtpParameters("audio",t),video:a.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return i(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){try{r.close()}catch(e){}var t=s.default.parse(e.sdp);return u.extractRtpCapabilities(t)}).catch(function(e){try{r.close()}catch(e){}throw e})}},{key:"tag",get:function(){return"ReactNative"}}]),o}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":25,"../utils":26,"./sdp/RemotePlanBSdp":19,"./sdp/commonUtils":21,"./sdp/planBUtils":22,"sdp-transform":35}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=f(e("sdp-transform")),n=f(e("../Logger")),s=f(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/planBUtils")),p=f(e("./sdp/RemotePlanBSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Safari11"),_=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new p.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),a(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),g=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r}return v(n,_),a(n,[{key:"addProducer",value:function(t){var r=this,n=t.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,n.id),this._stream.getTrackById(n.id))return Promise.reject(new Error("track already added"));var o=void 0,a=void 0;return Promise.resolve().then(function(){return r._stream.addTrack(n),o=r._pc.addTrack(n,r._stream),r._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){a=i.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(a)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(r._rtpParametersByKind[t.kind]);return l.fillRtpParametersForTrack(e,a,n),e}).catch(function(e){try{r._pc.removeTrack(o)}catch(e){}throw r._stream.removeTrack(n),e})}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===t});if(!e)throw new Error("RTCRtpSender found");return r._pc.removeTrack(e),r._stream.removeTrack(t),r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).catch(function(e){if(0!==r._stream.getTracks().length)throw e;y.warn("removeLocalTrack() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==r._pc.signalingState){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=i.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=i.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));return r._transportCreated=!1,r._transportUpdated=!1,r._kinds=new Set,r._consumerInfos=new Map,r}return v(n,_),a(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-"+e.id,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=i.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new g(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return a(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return r.addTransceiver("audio"),r.addTransceiver("video"),r.createOffer().then(function(e){try{r.close()}catch(e){}var t=i.default.parse(e.sdp);return d.extractRtpCapabilities(t)}).catch(function(e){try{r.close()}catch(e){}throw e})}},{key:"tag",get:function(){return"Safari11"}}]),o}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":25,"../utils":26,"./sdp/RemotePlanBSdp":19,"./sdp/commonUtils":21,"./sdp/planBUtils":22,"sdp-transform":35}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=h.clone(e),r=!0,n=!1,o=void 0;try{for(var a,i=t.codecs[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;if(s.channels=s.numChannels,delete s.numChannels,"audio"!==s.kind?delete s.channels:s.channels||(s.channels=1),s.mimeType=s.kind+"/"+s.name,s.parameters){var c=s.parameters;c.apt&&(c.apt=Number(c.apt)),c["packetization-mode"]&&(c["packetization-mode"]=Number(c["packetization-mode"]))}var u=!0,d=!1,l=void 0;try{for(var p,f=(s.rtcpFeedback||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;m.parameter||delete m.parameter}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}return t},r.mangleRtpParameters=function(e){var t=h.clone(e),r=!0,n=!1,o=void 0;try{for(var a,i=t.codecs[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;s.channels&&(s.numChannels=s.channels,delete s.channels),delete s.mimeType}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}return t};var h=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"))},{"../../utils":26}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),H=i(e("sdp-transform")),o=i(e("../../Logger")),a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var X=new o.default("RemotePlanBSdp"),d=function(){function t(e){u(this,t),this._rtpParametersByKind=e,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:a.randomNumber(),version:0}}return n(t,[{key:"setTransportLocalParameters",value:function(e){X.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){X.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){X.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),t}(),l=function(e){function t(e){return u(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return c(t,d),n(t,[{key:"createAnswerSdp",value:function(e){if(X.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},a=(e.media||[]).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},o.groups=[{type:"BUNDLE",mids:a.join(" ")}],o.media=[];var i=n.fingerprints.length,s=!0,c=!(o.fingerprint={type:n.fingerprints[i-1].algorithm,hash:n.fingerprints[i-1].value}),u=void 0;try{for(var d,l=(e.media||[])[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var p=d.value,f=p.type,m=this._rtpParametersByKind[f].codecs,h=this._rtpParametersByKind[f].headerExtensions,v={};v.type=p.type,v.port=7,v.protocol="RTP/SAVPF",v.connection={ip:"127.0.0.1",version:4},v.mid=p.mid,v.iceUfrag=t.usernameFragment,v.icePwd=t.password,v.candidates=[];var y=!0,_=!1,g=void 0;try{for(var b,w=r[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var P=b.value,k={component:1};k.foundation=P.foundation,k.ip=P.ip,k.port=P.port,k.priority=P.priority,k.transport=P.protocol,k.type=P.type,P.tcpType&&(k.tcptype=P.tcpType),v.candidates.push(k)}}catch(e){_=!0,g=e}finally{try{!y&&w.return&&w.return()}finally{if(_)throw g}}switch(v.endOfCandidates="end-of-candidates",v.iceOptions="renomination",n.role){case"client":v.setup="active";break;case"server":v.setup="passive"}switch(p.direction){case"sendrecv":case"sendonly":v.direction="recvonly";break;case"recvonly":case"inactive":v.direction="inactive"}"video"===f&&(v.xGoogleFlag="conference"),v.rtp=[],v.rtcpFb=[],v.fmtp=[];var S=!0,T=!1,C=void 0;try{for(var R,E=m[Symbol.iterator]();!(S=(R=E.next()).done);S=!0){var x=R.value,O={payload:x.payloadType,codec:x.name,rate:x.clockRate};if(1<x.channels&&(O.encoding=x.channels),v.rtp.push(O),x.parameters){var I={payload:x.payloadType,config:""},D=!0,j=!1,L=void 0;try{for(var F,A=Object.keys(x.parameters)[Symbol.iterator]();!(D=(F=A.next()).done);D=!0){var M=F.value;I.config&&(I.config+=";"),I.config+=M+"="+x.parameters[M]}}catch(e){j=!0,L=e}finally{try{!D&&A.return&&A.return()}finally{if(j)throw L}}I.config&&v.fmtp.push(I)}if(x.rtcpFeedback){var N=!0,B=!1,U=void 0;try{for(var q,z=x.rtcpFeedback[Symbol.iterator]();!(N=(q=z.next()).done);N=!0){var G=q.value;v.rtcpFb.push({payload:x.payloadType,type:G.type,subtype:G.parameter||""})}}catch(e){B=!0,U=e}finally{try{!N&&z.return&&z.return()}finally{if(B)throw U}}}}}catch(e){T=!0,C=e}finally{try{!S&&E.return&&E.return()}finally{if(T)throw C}}v.payloads=m.map(function(e){return e.payloadType}).join(" "),v.ext=[];var K=function(t){if(!(p.ext||[]).find(function(e){return e.uri===t.uri}))return"continue";v.ext.push({uri:t.uri,value:t.id})},V=!0,W=!1,Q=void 0;try{for(var $,J=h[Symbol.iterator]();!(V=($=J.next()).done);V=!0)K($.value)}catch(e){W=!0,Q=e}finally{try{!V&&J.return&&J.return()}finally{if(W)throw Q}}v.rtcpMux="rtcp-mux",v.rtcpRsize="rtcp-rsize",o.media.push(v)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return H.default.write(o)}}]),t}(),p=function(e){function t(e){return u(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return c(t,d),n(t,[{key:"createOfferSdp",value:function(e,G){var K=this;if(X.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var V=this._transportRemoteParameters.iceParameters,W=this._transportRemoteParameters.iceCandidates,t=this._transportRemoteParameters.dtlsParameters,Q={},r=e;this._sdpGlobalFields.version++,Q.version=0,Q.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},Q.name="-",Q.timing={start:0,stop:0},Q.icelite=V.iceLite?"ice-lite":null,Q.msidSemantic={semantic:"WMS",token:"*"},Q.groups=[{type:"BUNDLE",mids:r.join(" ")}],Q.media=[];var n=t.fingerprints.length,o=function(t){var e=K._rtpParametersByKind[t].codecs,r=K._rtpParametersByKind[t].headerExtensions,n={};n.type=t,n.port=7,n.protocol="RTP/SAVPF",n.connection={ip:"127.0.0.1",version:4},n.mid=t,n.iceUfrag=V.usernameFragment,n.icePwd=V.password;var o=!0,a=!(n.candidates=[]),i=void 0;try{for(var s,c=W[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value,d={component:1};d.foundation=u.foundation,d.ip=u.ip,d.port=u.port,d.priority=u.priority,d.transport=u.protocol,d.type=u.type,u.tcpType&&(d.tcptype=u.tcpType),n.candidates.push(d)}}catch(e){a=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw i}}n.endOfCandidates="end-of-candidates",n.iceOptions="renomination",n.setup="actpass",G.some(function(e){return e.kind===t})?n.direction="sendonly":n.direction="inactive",n.rtp=[],n.rtcpFb=[];var l=!0,p=!(n.fmtp=[]),f=void 0;try{for(var m,h=e[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value,y={payload:v.payloadType,codec:v.name,rate:v.clockRate};if(1<v.channels&&(y.encoding=v.channels),n.rtp.push(y),v.parameters){var _={payload:v.payloadType,config:""},g=!0,b=!1,w=void 0;try{for(var P,k=Object.keys(v.parameters)[Symbol.iterator]();!(g=(P=k.next()).done);g=!0){var S=P.value;_.config&&(_.config+=";"),_.config+=S+"="+v.parameters[S]}}catch(e){b=!0,w=e}finally{try{!g&&k.return&&k.return()}finally{if(b)throw w}}_.config&&n.fmtp.push(_)}if(v.rtcpFeedback){var T=!0,C=!1,R=void 0;try{for(var E,x=v.rtcpFeedback[Symbol.iterator]();!(T=(E=x.next()).done);T=!0){var O=E.value;n.rtcpFb.push({payload:v.payloadType,type:O.type,subtype:O.parameter||""})}}catch(e){C=!0,R=e}finally{try{!T&&x.return&&x.return()}finally{if(C)throw R}}}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}n.payloads=e.map(function(e){return e.payloadType}).join(" ");var I=!0,D=!(n.ext=[]),j=void 0;try{for(var L,F=r[Symbol.iterator]();!(I=(L=F.next()).done);I=!0){var A=L.value;n.ext.push({uri:A.uri,value:A.id})}}catch(e){D=!0,j=e}finally{try{!I&&F.return&&F.return()}finally{if(D)throw j}}n.rtcpMux="rtcp-mux",n.rtcpRsize="rtcp-rsize",n.ssrcs=[];var M=!0,N=!(n.ssrcGroups=[]),B=void 0;try{for(var U,q=G[Symbol.iterator]();!(M=(U=q.next()).done);M=!0){var z=U.value;z.kind===t&&(n.ssrcs.push({id:z.ssrc,attribute:"msid",value:z.streamId+" "+z.trackId}),n.ssrcs.push({id:z.ssrc,attribute:"mslabel",value:z.streamId}),n.ssrcs.push({id:z.ssrc,attribute:"label",value:z.trackId}),n.ssrcs.push({id:z.ssrc,attribute:"cname",value:z.cname}),z.rtxSsrc&&(n.ssrcs.push({id:z.rtxSsrc,attribute:"msid",value:z.streamId+" "+z.trackId}),n.ssrcs.push({id:z.rtxSsrc,attribute:"mslabel",value:z.streamId}),n.ssrcs.push({id:z.rtxSsrc,attribute:"label",value:z.trackId}),n.ssrcs.push({id:z.rtxSsrc,attribute:"cname",value:z.cname}),n.ssrcGroups.push({semantics:"FID",ssrcs:z.ssrc+" "+z.rtxSsrc})))}}catch(e){N=!0,B=e}finally{try{!M&&q.return&&q.return()}finally{if(N)throw B}}Q.media.push(n)},a=!0,i=!(Q.fingerprint={type:t.fingerprints[n-1].algorithm,hash:t.fingerprints[n-1].value}),s=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){o(c.value)}}catch(e){i=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}return H.default.write(Q)}}]),t}();r.default=function e(t,r){switch(u(this,e),X.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new l(r);case"recv":return new p(r)}}},{"../../Logger":5,"../../utils":26,"sdp-transform":35}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),ne=i(e("sdp-transform")),o=i(e("../../Logger")),a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var oe=new o.default("RemoteUnifiedPlanSdp"),d=function(){function t(e){u(this,t),this._rtpParametersByKind=e,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:a.randomNumber(),version:0}}return n(t,[{key:"setTransportLocalParameters",value:function(e){oe.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){oe.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){oe.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),t}(),l=function(e){function t(e){return u(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return c(t,d),n(t,[{key:"createAnswerSdp",value:function(e){if(oe.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},a=(e.media||[]).filter(function(e){return e.mid}).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},0<a.length&&(o.groups=[{type:"BUNDLE",mids:a.join(" ")}]),o.media=[];var i=n.fingerprints.length,s=!0,c=!(o.fingerprint={type:n.fingerprints[i-1].algorithm,hash:n.fingerprints[i-1].value}),u=void 0;try{for(var d,l=(e.media||[])[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var p=d.value,f="inactive"===p.direction,m=p.type,h=this._rtpParametersByKind[m].codecs,v=this._rtpParametersByKind[m].headerExtensions,y={};y.type=p.type,y.port=7,y.protocol="RTP/SAVPF",y.connection={ip:"127.0.0.1",version:4},y.mid=p.mid,y.iceUfrag=t.usernameFragment,y.icePwd=t.password,y.candidates=[];var _=!0,g=!1,b=void 0;try{for(var w,P=r[Symbol.iterator]();!(_=(w=P.next()).done);_=!0){var k=w.value,S={component:1};S.foundation=k.foundation,S.ip=k.ip,S.port=k.port,S.priority=k.priority,S.transport=k.protocol,S.type=k.type,k.tcpType&&(S.tcptype=k.tcpType),y.candidates.push(S)}}catch(e){g=!0,b=e}finally{try{!_&&P.return&&P.return()}finally{if(g)throw b}}switch(y.endOfCandidates="end-of-candidates",y.iceOptions="renomination",n.role){case"client":y.setup="active";break;case"server":y.setup="passive"}switch(p.direction){case"sendrecv":case"sendonly":y.direction="recvonly";break;case"recvonly":case"inactive":y.direction="inactive"}y.rtp=[],y.rtcpFb=[],y.fmtp=[];var T=!0,C=!1,R=void 0;try{for(var E,x=h[Symbol.iterator]();!(T=(E=x.next()).done);T=!0){var O=E.value,I={payload:O.payloadType,codec:O.name,rate:O.clockRate};if(1<O.channels&&(I.encoding=O.channels),y.rtp.push(I),O.parameters){var D={payload:O.payloadType,config:""},j=!0,L=!1,F=void 0;try{for(var A,M=Object.keys(O.parameters)[Symbol.iterator]();!(j=(A=M.next()).done);j=!0){var N=A.value;D.config&&(D.config+=";"),D.config+=N+"="+O.parameters[N]}}catch(e){L=!0,F=e}finally{try{!j&&M.return&&M.return()}finally{if(L)throw F}}D.config&&y.fmtp.push(D)}if(O.rtcpFeedback){var B=!0,U=!1,q=void 0;try{for(var z,G=O.rtcpFeedback[Symbol.iterator]();!(B=(z=G.next()).done);B=!0){var K=z.value;y.rtcpFb.push({payload:O.payloadType,type:K.type,subtype:K.parameter||""})}}catch(e){U=!0,q=e}finally{try{!B&&G.return&&G.return()}finally{if(U)throw q}}}}}catch(e){C=!0,R=e}finally{try{!T&&x.return&&x.return()}finally{if(C)throw R}}if(y.payloads=h.map(function(e){return e.payloadType}).join(" "),!f){y.ext=[];var V=function(t){if(!(p.ext||[]).find(function(e){return e.uri===t.uri}))return"continue";y.ext.push({uri:t.uri,value:t.id})},W=!0,Q=!1,$=void 0;try{for(var J,H=v[Symbol.iterator]();!(W=(J=H.next()).done);W=!0)V(J.value)}catch(e){Q=!0,$=e}finally{try{!W&&H.return&&H.return()}finally{if(Q)throw $}}}if(p.simulcast_03){y.simulcast_03={value:p.simulcast_03.value.replace(/send/g,"recv")},y.rids=[];var X=!0,Z=!1,Y=void 0;try{for(var ee,te=(p.rids||[])[Symbol.iterator]();!(X=(ee=te.next()).done);X=!0){var re=ee.value;"send"===re.direction&&y.rids.push({id:re.id,direction:"recv"})}}catch(e){Z=!0,Y=e}finally{try{!X&&te.return&&te.return()}finally{if(Z)throw Y}}}y.rtcpMux="rtcp-mux",y.rtcpRsize="rtcp-rsize",o.media.push(y)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return ne.default.write(o)}}]),t}(),p=function(e){function t(e){return u(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return c(t,d),n(t,[{key:"createOfferSdp",value:function(e){if(oe.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},a=e.map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},0<a.length&&(o.groups=[{type:"BUNDLE",mids:a.join(" ")}]),o.media=[];var i=n.fingerprints.length,s=!0,c=!(o.fingerprint={type:n.fingerprints[i-1].algorithm,hash:n.fingerprints[i-1].value}),u=void 0;try{for(var d,l=e[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var p=d.value,f=p.closed,m=p.kind,h=void 0,v=void 0;"application"!==p.kind&&(h=this._rtpParametersByKind[m].codecs,v=this._rtpParametersByKind[m].headerExtensions);var y={};"application"!==p.kind?(y.type=m,y.port=7,y.protocol="RTP/SAVPF",y.connection={ip:"127.0.0.1",version:4},y.mid=p.mid,y.msid=p.streamId+" "+p.trackId):(y.type=m,y.port=9,y.protocol="DTLS/SCTP",y.connection={ip:"127.0.0.1",version:4},y.mid=p.mid),y.iceUfrag=t.usernameFragment,y.icePwd=t.password,y.candidates=[];var _=!0,g=!1,b=void 0;try{for(var w,P=r[Symbol.iterator]();!(_=(w=P.next()).done);_=!0){var k=w.value,S={component:1};S.foundation=k.foundation,S.ip=k.ip,S.port=k.port,S.priority=k.priority,S.transport=k.protocol,S.type=k.type,k.tcpType&&(S.tcptype=k.tcpType),y.candidates.push(S)}}catch(e){g=!0,b=e}finally{try{!_&&P.return&&P.return()}finally{if(g)throw b}}if(y.endOfCandidates="end-of-candidates",y.iceOptions="renomination",y.setup="actpass","application"!==p.kind){y.direction=f?"inactive":"sendonly",y.rtp=[],y.rtcpFb=[],y.fmtp=[];var T=!0,C=!1,R=void 0;try{for(var E,x=h[Symbol.iterator]();!(T=(E=x.next()).done);T=!0){var O=E.value,I={payload:O.payloadType,codec:O.name,rate:O.clockRate};if(1<O.channels&&(I.encoding=O.channels),y.rtp.push(I),O.parameters){var D={payload:O.payloadType,config:""},j=!0,L=!1,F=void 0;try{for(var A,M=Object.keys(O.parameters)[Symbol.iterator]();!(j=(A=M.next()).done);j=!0){var N=A.value;D.config&&(D.config+=";"),D.config+=N+"="+O.parameters[N]}}catch(e){L=!0,F=e}finally{try{!j&&M.return&&M.return()}finally{if(L)throw F}}D.config&&y.fmtp.push(D)}if(O.rtcpFeedback){var B=!0,U=!1,q=void 0;try{for(var z,G=O.rtcpFeedback[Symbol.iterator]();!(B=(z=G.next()).done);B=!0){var K=z.value;y.rtcpFb.push({payload:O.payloadType,type:K.type,subtype:K.parameter||""})}}catch(e){U=!0,q=e}finally{try{!B&&G.return&&G.return()}finally{if(U)throw q}}}}}catch(e){C=!0,R=e}finally{try{!T&&x.return&&x.return()}finally{if(C)throw R}}if(y.payloads=h.map(function(e){return e.payloadType}).join(" "),!f){y.ext=[];var V=!0,W=!1,Q=void 0;try{for(var $,J=v[Symbol.iterator]();!(V=($=J.next()).done);V=!0){var H=$.value;y.ext.push({uri:H.uri,value:H.id})}}catch(e){W=!0,Q=e}finally{try{!V&&J.return&&J.return()}finally{if(W)throw Q}}}y.rtcpMux="rtcp-mux",y.rtcpRsize="rtcp-rsize",f||(y.ssrcs=[],y.ssrcGroups=[],y.ssrcs.push({id:p.ssrc,attribute:"cname",value:p.cname}),p.rtxSsrc&&(y.ssrcs.push({id:p.rtxSsrc,attribute:"cname",value:p.cname}),y.ssrcGroups.push({semantics:"FID",ssrcs:p.ssrc+" "+p.rtxSsrc})))}else y.payloads=5e3,y.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};o.media.push(y)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return ne.default.write(o)}}]),t}();r.default=function e(t,r){switch(u(this,e),oe.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new l(r);case"recv":return new p(r)}}},{"../../Logger":5,"../../utils":26,"sdp-transform":35}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractRtpCapabilities=function(e){var t=new Map,r=[],n=!1,o=!1,a=!0,i=!1,s=void 0;try{for(var c,u=e.media[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value,l=d.type;switch(l){case"audio":if(n)continue;n=!0;break;case"video":if(o)continue;o=!0;break;default:continue}var p=!0,f=!1,m=void 0;try{for(var h,v=d.rtp[Symbol.iterator]();!(p=(h=v.next()).done);p=!0){var y=h.value,_={name:y.codec,mimeType:l+"/"+y.codec,kind:l,clockRate:y.rate,preferredPayloadType:y.payload,channels:y.encoding,rtcpFeedback:[],parameters:{}};"audio"!==_.kind?delete _.channels:_.channels||(_.channels=1),t.set(_.preferredPayloadType,_)}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}var g=!0,b=!1,w=void 0;try{for(var P,k=(d.fmtp||[])[Symbol.iterator]();!(g=(P=k.next()).done);g=!0){var S=P.value,T=U.default.parseFmtpConfig(S.config),_=t.get(S.payload);_&&(_.parameters=T)}}catch(e){b=!0,w=e}finally{try{!g&&k.return&&k.return()}finally{if(b)throw w}}var C=!0,R=!1,E=void 0;try{for(var x,O=(d.rtcpFb||[])[Symbol.iterator]();!(C=(x=O.next()).done);C=!0){var I=x.value,_=t.get(I.payload);if(_){var D={type:I.type,parameter:I.subtype};D.parameter||delete D.parameter,_.rtcpFeedback.push(D)}}}catch(e){R=!0,E=e}finally{try{!C&&O.return&&O.return()}finally{if(R)throw E}}var j=!0,L=!1,F=void 0;try{for(var A,M=(d.ext||[])[Symbol.iterator]();!(j=(A=M.next()).done);j=!0){var N=A.value,B={kind:l,uri:N.uri,preferredId:N.value};r.push(B)}}catch(e){L=!0,F=e}finally{try{!j&&M.return&&M.return()}finally{if(L)throw F}}}}catch(e){i=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}},r.extractDtlsParameters=function(e){var t=(o=e,(o.media||[]).find(function(e){return e.iceUfrag&&0!==e.port})),r=t.fingerprint||e.fingerprint,n=void 0;var o;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}};var n,o=e("sdp-transform"),U=(n=o)&&n.__esModule?n:{default:n}},{"sdp-transform":35}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var K=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.fillRtpParametersForTrack=function(e,t,r){var n=r.kind,o={cname:null,reducedSize:!0,mux:!0},a=(t.media||[]).find(function(e){return e.type===n});if(!a)throw new Error("m="+n+" section not found");var i=void 0,s=new Set,c=!0,u=!1,d=void 0;try{for(var l,p=(a.ssrcs||[])[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value;if("msid"===f.attribute){var m=f.value.split(" ")[1];if(m===r.id){var h=f.id;s.add(h),i||(i=h)}}}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}if(0===s.size)throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");var v=new Map,y=!0,_=!1,g=void 0;try{for(var b,w=(a.ssrcGroups||[])[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var P=b.value;if("FID"===P.semantics){var k=P.ssrcs.split(/\s+/),S=K(k,2),T=S[0],C=S[1];T=Number(T),C=Number(C),s.has(T)&&(s.delete(T),s.delete(C),v.set(T,C))}}}catch(e){_=!0,g=e}finally{try{!y&&w.return&&w.return()}finally{if(_)throw g}}var R=!0,E=!1,x=void 0;try{for(var O,I=s[Symbol.iterator]();!(R=(O=I.next()).done);R=!0){var T=O.value;v.set(T,null)}}catch(e){E=!0,x=e}finally{try{!R&&I.return&&I.return()}finally{if(E)throw x}}var D=a.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===i});D&&(o.cname=D.value);e.rtcp=o,e.encodings=[];var j=1<v.size,L=["low","medium","high"],F=!0,A=!1,M=void 0;try{for(var N,B=v[Symbol.iterator]();!(F=(N=B.next()).done);F=!0){var U=N.value,q=K(U,2),z=q[0],C=q[1],G={ssrc:z};C&&(G.rtx={ssrc:C}),j&&(G.profile=L.shift()),e.encodings.push(G)}}catch(e){A=!0,M=e}finally{try{!F&&B.return&&B.return()}finally{if(A)throw M}}},r.addSimulcastForTrack=function(e,r){var t=r.kind,n=(e.media||[]).find(function(e){return e.type===t});if(!n)throw new Error("m="+t+" section not found");var o=void 0,a=void 0,i=void 0;if(!(n.ssrcs||[]).find(function(e){if("msid"!==e.attribute)return!1;var t=e.value.split(" ")[1];return t===r.id?(o=e.id,i=e.value.split(" ")[0],!0):void 0}))throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");(n.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===o?(a=Number(t[1]),!0):void 0}});var s=n.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===o});if(!s)throw new Error("CNAME line not found for local track [track.id:"+r.id+"]");var c=s.value,u=o+1,d=o+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:"SIM",ssrcs:o+" "+u+" "+d}),n.ssrcs.push({id:u,attribute:"cname",value:c}),n.ssrcs.push({id:u,attribute:"msid",value:i+" "+r.id}),n.ssrcs.push({id:d,attribute:"cname",value:c}),n.ssrcs.push({id:d,attribute:"msid",value:i+" "+r.id}),a){var l=a+1,p=a+2;n.ssrcGroups.push({semantics:"FID",ssrcs:u+" "+l}),n.ssrcs.push({id:l,attribute:"cname",value:c}),n.ssrcs.push({id:l,attribute:"msid",value:i+" "+r.id}),n.ssrcGroups.push({semantics:"FID",ssrcs:d+" "+p}),n.ssrcs.push({id:p,attribute:"cname",value:c}),n.ssrcs.push({id:p,attribute:"msid",value:i+" "+r.id})}}},{}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,n){var o=n.kind,r={cname:null,reducedSize:!0,mux:!0},a=(t.media||[]).find(function(e){if(e.type===o){var t=e.msid;if(t){var r=t.split(" ")[1];return r===n.id||void 0}}});if(!a)throw new Error("m="+o+" section not found");var i=(a.ssrcs||[]).find(function(e){return"cname"===e.attribute}),s=void 0;i&&(s=i.id,r.cname=i.value);var c=[],u=!0,d=!1,l=void 0;try{for(var p,f=(a.rids||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;"send"===m.direction&&(/^low/.test(m.id)?c.push({rid:m.id,profile:"low"}):/^medium/.test(m.id)&&c.push({rid:m.id,profile:"medium"}),/^high/.test(m.id)&&c.push({rid:m.id,profile:"high"}))}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}if(e.rtcp=r,e.encodings=[],0===c.length){var h={ssrc:s};e.encodings.push(h)}else{var v=!0,y=!1,_=void 0;try{for(var g,b=c[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value,P={encodingId:w.rid,profile:w.profile};e.encodings.push(P)}}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}}}},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Room=void 0,r.isDeviceSupported=function(){return o.default.isSupported()},r.getDeviceInfo=function(){return{flag:o.default.getFlag(),name:o.default.getName(),version:o.default.getVersion(),bowser:o.default.getBowser()}},r.checkCapabilitiesForRoom=function(r){return o.default.isSupported()?o.default.Handler.getNativeRtpCapabilities().then(function(e){var t=n.getExtendedRtpCapabilities(e,r);return{audio:n.canSend("audio",t),video:n.canSend("video",t)}}):Promise.reject(new Error("current browser/device not supported"))};var n=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./ortc")),o=i(e("./Device")),a=i(e("./Room"));function i(e){return e&&e.__esModule?e:{default:e}}r.Room=a.default},{"./Device":3,"./Room":8,"./ortc":25}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getExtendedRtpCapabilities=function(o,n){var a={codecs:[],headerExtensions:[],fecMechanisms:[]},e=function(t){if("rtx"===t.name)return"continue";var e=(o.codecs||[]).find(function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){var o=(e.parameters||{})["packetization-mode"]||0,a=(t.parameters||{})["packetization-mode"]||0;if(o!==a)return!1}return!0}(e,t)});if(e){var r={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:e.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:function(e,r){var n=[],t=function(t){var e=(r.rtcpFeedback||[]).find(function(e){return e.type===t.type&&e.parameter===t.parameter});e&&n.push(e)},o=!0,a=!1,i=void 0;try{for(var s,c=(e.rtcpFeedback||[])[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;t(u)}}catch(e){a=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(a)throw i}}return n}(e,t),parameters:t.parameters};r.channels||delete r.channels,a.codecs.push(r)}},t=!0,r=!1,i=void 0;try{for(var s,c=(n.codecs||[])[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var u=s.value;e(u)}}catch(e){r=!0,i=e}finally{try{!t&&c.return&&c.return()}finally{if(r)throw i}}var d=function(t){var e=(o.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===t.sendPayloadType}),r=(n.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===t.recvPayloadType});e&&r&&(t.sendRtxPayloadType=e.preferredPayloadType,t.recvRtxPayloadType=r.preferredPayloadType)},l=!0,p=!1,f=void 0;try{for(var m,h=(a.codecs||[])[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;d(v)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}var y=function(n){var e=(o.headerExtensions||[]).find(function(e){return r=n,!((t=e).kind&&r.kind&&t.kind!==r.kind||t.uri!==r.uri);var t,r});if(e){var t={kind:n.kind,uri:n.uri,sendId:e.preferredId,recvId:n.preferredId};a.headerExtensions.push(t)}},_=!0,g=!1,b=void 0;try{for(var w,P=(n.headerExtensions||[])[Symbol.iterator]();!(_=(w=P.next()).done);_=!0){var k=w.value;y(k)}}catch(e){g=!0,b=e}finally{try{!_&&P.return&&P.return()}finally{if(g)throw b}}return a},r.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var a,i=e.codecs[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:s.kind+"/rtx",kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}var d=!0,l=!1,p=void 0;try{for(var f,m=e.headerExtensions[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value,v={kind:h.kind,uri:h.uri,preferredId:h.recvId};t.headerExtensions.push(v)}}catch(e){l=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(l)throw p}}return t.fecMechanisms=e.fecMechanisms,t},r.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,a=r.codecs,i=function(t){if(!a.some(function(e){return e.recvPayloadType===t})){var e=o.find(function(e){return e.preferredPayloadType===t});if(!e)throw new Error("mandatory codec PT "+t+" not found in remote codecs");n.push(e)}},s=!0,c=!1,u=void 0;try{for(var d,l=t[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var p=d.value;i(p)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return n},r.canSend=function(t,e){return e.codecs.some(function(e){return e.kind===t})},r.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some(function(e){return e.recvPayloadType===r.payloadType})},r.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.sendId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return r},r.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.recvId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return r}},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.randomNumber=function(){return a()},r.clone=function(e){return JSON.parse(JSON.stringify(e))};var n,o=e("random-number");var a=((n=o)&&n.__esModule?n:{default:n}).default.generator({min:1e7,max:99999999,integer:!0})},{"random-number":33}],27:[function(e,t,r){var n,o;n=this,o=function(){var S=!0;function i(r){function e(e){var t=r.match(e);return t&&1<t.length&&t[1]||""}function t(e){var t=r.match(e);return t&&1<t.length&&t[2]||""}var n,o=e(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(r)&&/android/i.test(r),i=/nexus\s*[0-6]\s*/i.test(r),s=!i&&/nexus\s*[0-9]+/i.test(r),c=/CrOS/.test(r),u=/silk/i.test(r),d=/sailfish/i.test(r),l=/tizen/i.test(r),p=/(web|hpw)os/i.test(r),f=/windows phone/i.test(r),m=(/SamsungBrowser/i.test(r),!f&&/windows/i.test(r)),h=!o&&!u&&/macintosh/i.test(r),v=!a&&!d&&!l&&!p&&/linux/i.test(r),y=t(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),_=e(/version\/(\d+(\.\d+)?)/i),g=/tablet/i.test(r)&&!/tablet pc/i.test(r),b=!g&&/[^-]mobi/i.test(r),w=/xbox/i.test(r);/opera/i.test(r)?n={name:"Opera",opera:S,version:_||e(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(r)?n={name:"Opera",opera:S,version:e(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||_}:/SamsungBrowser/i.test(r)?n={name:"Samsung Internet for Android",samsungBrowser:S,version:_||e(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(r)?n={name:"Opera Coast",coast:S,version:_||e(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(r)?n={name:"Yandex Browser",yandexbrowser:S,version:_||e(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(r)?n={name:"UC Browser",ucbrowser:S,version:e(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(r)?n={name:"Maxthon",maxthon:S,version:e(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(r)?n={name:"Epiphany",epiphany:S,version:e(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(r)?n={name:"Puffin",puffin:S,version:e(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(r)?n={name:"Sleipnir",sleipnir:S,version:e(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(r)?n={name:"K-Meleon",kMeleon:S,version:e(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:f?(n={name:"Windows Phone",osname:"Windows Phone",windowsphone:S},y?(n.msedge=S,n.version=y):(n.msie=S,n.version=e(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(r)?n={name:"Internet Explorer",msie:S,version:e(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:c?n={name:"Chrome",osname:"Chrome OS",chromeos:S,chromeBook:S,chrome:S,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(r)?n={name:"Microsoft Edge",msedge:S,version:y}:/vivaldi/i.test(r)?n={name:"Vivaldi",vivaldi:S,version:e(/vivaldi\/(\d+(\.\d+)?)/i)||_}:d?n={name:"Sailfish",osname:"Sailfish OS",sailfish:S,version:e(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(r)?n={name:"SeaMonkey",seamonkey:S,version:e(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(r)?(n={name:"Firefox",firefox:S,version:e(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(r)&&(n.firefoxos=S,n.osname="Firefox OS")):u?n={name:"Amazon Silk",silk:S,version:e(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(r)?n={name:"PhantomJS",phantom:S,version:e(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(r)?n={name:"SlimerJS",slimer:S,version:e(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(r)||/rim\stablet/i.test(r)?n={name:"BlackBerry",osname:"BlackBerry OS",blackberry:S,version:_||e(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(n={name:"WebOS",osname:"WebOS",webos:S,version:_||e(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(r)&&(n.touchpad=S)):/bada/i.test(r)?n={name:"Bada",osname:"Bada",bada:S,version:e(/dolfin\/(\d+(\.\d+)?)/i)}:l?n={name:"Tizen",osname:"Tizen",tizen:S,version:e(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||_}:/qupzilla/i.test(r)?n={name:"QupZilla",qupzilla:S,version:e(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||_}:/chromium/i.test(r)?n={name:"Chromium",chromium:S,version:e(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||_}:/chrome|crios|crmo/i.test(r)?n={name:"Chrome",chrome:S,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?n={name:"Android",version:_}:/safari|applewebkit/i.test(r)?(n={name:"Safari",safari:S},_&&(n.version=_)):o?(n={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},_&&(n.version=_)):n=/googlebot/i.test(r)?{name:"Googlebot",googlebot:S,version:e(/googlebot\/(\d+(\.\d+))/i)||_}:{name:e(/^(.*)\/(.*) /),version:t(/^(.*)\/(.*) /)},!n.msedge&&/(apple)?webkit/i.test(r)?(/(apple)?webkit\/537\.36/i.test(r)?(n.name=n.name||"Blink",n.blink=S):(n.name=n.name||"Webkit",n.webkit=S),!n.version&&_&&(n.version=_)):!n.opera&&/gecko\//i.test(r)&&(n.name=n.name||"Gecko",n.gecko=S,n.version=n.version||e(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||!a&&!n.silk?!n.windowsphone&&o?(n[o]=S,n.ios=S,n.osname="iOS"):h?(n.mac=S,n.osname="macOS"):w?(n.xbox=S,n.osname="Xbox"):m?(n.windows=S,n.osname="Windows"):v&&(n.linux=S,n.osname="Linux"):(n.android=S,n.osname="Android");var P="";n.windows?P=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(e(/Windows ((NT|XP)( \d\d?.\d)?)/i)):n.windowsphone?P=e(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?P=(P=e(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?P=(P=e(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?P=e(/android[ \/-](\d+(\.\d+)*)/i):n.webos?P=e(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?P=e(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?P=e(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(P=e(/tizen[\/\s](\d+(\.\d+)*)/i)),P&&(n.osversion=P);var k=!n.windows&&P.split(".")[0];return g||s||"ipad"==o||a&&(3==k||4<=k&&!b)||n.silk?n.tablet=S:(b||"iphone"==o||"ipod"==o||a||i||n.blackberry||n.webos||n.bada)&&(n.mobile=S),n.msedge||n.msie&&10<=n.version||n.yandexbrowser&&15<=n.version||n.vivaldi&&1<=n.version||n.chrome&&20<=n.version||n.samsungBrowser&&4<=n.version||n.firefox&&20<=n.version||n.safari&&6<=n.version||n.opera&&10<=n.version||n.ios&&n.osversion&&6<=n.osversion.split(".")[0]||n.blackberry&&10.1<=n.version||n.chromium&&20<=n.version?n.a=S:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=S:n.x=S,n}var s=i("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function c(e){for(var r=Math.max(n(e[0]),n(e[1])),t=o(e,function(e){var t=r-n(e);return o((e+=new Array(t+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});0<=--r;){if(t[0][r]>t[1][r])return 1;if(t[0][r]!==t[1][r])return-1;if(0===r)return 0}}function a(e,t,r){var n=s;"string"==typeof t&&(r=t,t=void 0),void 0===t&&(t=!1),r&&(n=i(r));var o=""+n.version;for(var a in e)if(e.hasOwnProperty(a)&&n[a]){if("string"!=typeof e[a])throw new Error("Browser version in the minVersion map should be a string: "+a+": "+String(e));return c([o,e[a]])<0}return t}return s.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in s)return!0}return!1},s.isUnsupportedBrowser=a,s.compareVersions=c,s.check=function(e,t,r){return!a(e,t,r)},s._detect=i,s.detect=i,s},void 0!==t&&t.exports?t.exports=o():n.bowser=o()},{}],28:[function(r,n,a){(function(t){function e(){var e;try{e=a.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(a=n.exports=r("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},a.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+a.humanize(this.diff),!t)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))}),e.splice(o,0,r)},a.save=function(e){try{null==e?a.storage.removeItem("debug"):a.storage.debug=e}catch(e){}},a.load=e,a.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},a.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),a.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],a.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},a.enable(e())}).call(this,r("_process"))},{"./debug":29,_process:32}],29:[function(e,t,c){function r(e){var n;function s(){if(s.enabled){var o=s,e=+new Date,t=e-(n||e);o.diff=t,o.prev=n,o.curr=e,n=e;for(var a=new Array(arguments.length),r=0;r<a.length;r++)a[r]=arguments[r];a[0]=c.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var i=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;i++;var r=c.formatters[t];if("function"==typeof r){var n=a[i];e=r.call(o,n),a.splice(i,1),i--}return e}),c.formatArgs.call(o,a),(s.log||c.log||console.log.bind(console)).apply(o,a)}}return s.namespace=e,s.enabled=c.enabled(e),s.useColors=c.useColors(),s.color=function(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return c.colors[Math.abs(r)%c.colors.length]}(e),s.destroy=o,"function"==typeof c.init&&c.init(s),c.instances.push(s),s}function o(){var e=c.instances.indexOf(this);return-1!==e&&(c.instances.splice(e,1),!0)}(c=t.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},c.disable=function(){c.enable("")},c.enable=function(e){var t;c.save(e),c.names=[],c.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?c.skips.push(new RegExp("^"+e.substr(1)+"$")):c.names.push(new RegExp("^"+e+"$")));for(t=0;t<c.instances.length;t++){var o=c.instances[t];o.enabled=c.enabled(o.namespace)}},c.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=c.skips.length;t<r;t++)if(c.skips[t].test(e))return!1;for(t=0,r=c.names.length;t<r;t++)if(c.names[t].test(e))return!0;return!1},c.humanize=e("ms"),c.instances=[],c.names=[],c.skips=[],c.formatters={}},{ms:31}],30:[function(e,t,r){var c=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},a=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=c(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var o,s=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),o=0===u.x}catch(e){o=!1}function d(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var o,a,i;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),i=a[t]):(a=e._events=c(null),e._eventsCount=0),i){if("function"==typeof i?i=a[t]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),!i.warned&&(o=d(e))&&0<o&&i.length>o){i.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+i.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=i.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message)}}else i=a[t]=r,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=a.call(p,n);return o.listener=r,n.wrapFn=o}function m(e,t,r){var n=e._events;if(!n)return[];var o=n[t];return o?"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):v(o,o.length):[]}function h(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}o?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):n.defaultMaxListeners=s,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return d(this)},n.prototype.emit=function(e){var t,r,n,o,a,i,s="error"===e;if(i=this._events)s=s&&null==i.error;else if(!s)return!1;if(s){if(1<arguments.length&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(r=i[e]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,o=v(e,n),a=0;a<n;++a)o[a].call(r)}(r,u,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,a=v(e,o),i=0;i<o;++i)a[i].call(r,n)}(r,u,this,arguments[1]);break;case 3:!function(e,t,r,n,o){if(t)e.call(r,n,o);else for(var a=e.length,i=v(e,a),s=0;s<a;++s)i[s].call(r,n,o)}(r,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,o,a){if(t)e.call(r,n,o,a);else for(var i=e.length,s=v(e,i),c=0;c<i;++c)s[c].call(r,n,o,a)}(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),a=1;a<n;a++)o[a-1]=arguments[a];!function(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,a=v(e,o),i=0;i<o;++i)a[i].apply(r,n)}(r,u,this,o)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){return l(this,e,t,!1)},n.prototype.prependListener=function(e,t){return l(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,n,o,a,i;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=c(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,a=r.length-1;0<=a;a--)if(r[a]===t||r[a].listener===t){i=r[a].listener,o=a;break}if(o<0)return this;0===o?r.shift():function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),n.removeListener&&this.emit("removeListener",e,i||t)}return this},n.prototype.removeAllListeners=function(e){var t,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=c(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=c(null):delete r[e]),this;if(0===arguments.length){var o,a=i(r);for(n=0;n<a.length;++n)"removeListener"!==(o=a[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=c(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(n=t.length-1;0<=n;n--)this.removeListener(e,t[n]);return this},n.prototype.listeners=function(e){return m(this,e,!0)},n.prototype.rawListeners=function(e){return m(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},n.prototype.listenerCount=h,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],31:[function(e,t,r){var o=36e5,a=864e5;function i(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){t=t||{};var r,n=typeof e;if("string"===n&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?i(r=e,a,"day")||i(r,o,"hour")||i(r,6e4,"minute")||i(r,1e3,"second")||r+" ms":function(e){if(a<=e)return Math.round(e/a)+"d";if(o<=e)return Math.round(e/o)+"h";if(6e4<=e)return Math.round(e/6e4)+"m";if(1e3<=e)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],32:[function(e,t,r){var n,o,a=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,d=[],l=!1,p=-1;function f(){l&&u&&(l=!1,u.length?d=u.concat(d):p=-1,d.length&&m())}function m(){if(!l){var e=c(f);l=!0;for(var t=d.length;t;){for(u=d,d=[];++p<t;)u&&u[p].run();p=-1,t=d.length}u=null,l=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new h(e,t)),1!==d.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],33:[function(e,t,r){!function(e){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function o(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}t.exports=o,t.exports.generator=function(n){return n=r(n),function(e,t,r){return n.min=null!=e?e:n.min,n.max=null!=t?t:n.max,n.integer=null!=r?r:n.integer,o(n)}},t.exports.defaults=r}()},{}],34:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],35:[function(e,t,r){var n=e("./parser"),o=e("./writer");r.write=o,r.parse=n.parse,r.parseFmtpConfig=n.parseFmtpConfig,r.parseParams=n.parseParams,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":36,"./writer":37}],36:[function(e,t,r){var a=function(e){return String(Number(e))===e?Number(e):e},s=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=a(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=a(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},c=e("./grammar"),n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},a=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(n).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),i=a[a.length-1]);for(var n=0;n<(c[t]||[]).length;n+=1){var o=c[t][n];if(o.reg.test(r))return s(o,i,r)}}),t.media=a,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=a(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e};r.parseParams=function(e){return e.split(/\;\s?/).reduce(o,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(a),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=a(e):(t=a(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},{"./grammar":34}],37:[function(e,t,r){var a=e("./grammar"),i=/%[sdv%]/g,s=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?n.push(r[t.name][a]):n.push(r[t.names[o]])}else n.push(r[t.name]);return function(e){var r=1,n=arguments,o=n.length;return e.replace(i,function(e){if(o<=r)return e;var t=n[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})}.apply(null,n)},c=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||c,n=t.innerOrder||u,o=[];return r.forEach(function(r){a[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(s(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(s(r,t,e))})})}),e.media.forEach(function(e){o.push(s("m",a.m[0],e)),n.forEach(function(r){a[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(s(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(s(r,t,e))})})})}),o.join("\r\n")+"\r\n"}},{"./grammar":34}]},{},[24])(24)});