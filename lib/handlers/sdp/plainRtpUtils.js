/**
 * Extract plain RTP parameters from a SDP.
 *
 * @param {Object} sdpObj - SDP Object generated by sdp-transform.
 * @param {String} kind - media type.
 *
 * @returns {Object} with ip and port.
 */
exports.extractPlainRtpParametersByKind = function(sdpObj, kind)
{
	const mSection = findMediaSection(sdpObj, kind);

	if (!mSection)
		throw new Error(`m=${kind} section not found`);

	const plainRtpParameters =
	{
		ip   : sdpObj.connection.ip,
		port : mSection.port
	};

	return plainRtpParameters;
};

/**
 * Fill the given RTP parameters for the given media type.
 *
 * @param {RTCRtpParameters} rtpParameters - RTP parameters to be filled.
 * @param {Object} sdpObj - Local SDP Object generated by sdp-transform.
 * @param {String} kind - media type.
 */
exports.fillRtpParametersForKind = function(rtpParameters, sdpObj, kind)
{
	const rtcp =
	{
		cname       : null,
		reducedSize : true,
		mux         : true
	};

	const mSection = findMediaSection(sdpObj, kind);

	if (!mSection)
		throw new Error(`m=${kind} section not found`);

	// Get the SSRC and CNAME.

	const ssrcCnameLine = (mSection.ssrcs || [])
		.find((line) => line.attribute === 'cname');

	let ssrc;

	if (ssrcCnameLine)
	{
		ssrc = ssrcCnameLine.id;
		rtcp.cname = ssrcCnameLine.value;
	}

	// Fill RTP parameters.

	rtpParameters.rtcp = rtcp;
	rtpParameters.encodings = [];

	const encoding = { ssrc };

	rtpParameters.encodings.push(encoding);
};

function findMediaSection(sdpObj, kind)
{
	const mSection = (sdpObj.media || [])
		.find((m) => m.type === kind);

	return mSection;
}
